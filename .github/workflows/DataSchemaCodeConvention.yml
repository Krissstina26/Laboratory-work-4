name: Data Schema Code Convention Check

on:
  push:
    branches: [ "main" ]
  workflow_dispatch:

jobs:
  validate-schema:
    name: Validate Data Schema Rules
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v4

      - name: Check file exists
        run: |
          if [ ! -f DataSchema.sql ] && [ ! -f DataSchemaModified.sql ]; then
            echo "Schema file not found"
            exit 1
          fi

      - name: Validate naming conventions
        run: |
          FILE=DataSchemaModified.sql
          echo "Checking snake_case rules..."

          if grep -E "CREATE TABLE [A-Z]" $FILE; then
            echo "❌ Table names must be in snake_case"
            exit 1
          fi

          if grep -E "[a-z]+[A-Z]+" $FILE; then
            echo "❌ CamelCase detected"
            exit 1
          fi

      - name: Validate light_level constraint
        run: |
          FILE=DataSchemaModified.sql
          if grep -E "lightLevel < 0" $FILE; then
            echo "❌ light_level must be >= 0"
            exit 1
          fi

      - name: Validate regex for user_name
        run: |
          FILE=DataSchemaModified.sql
          if grep -E "\^\[0-9\]\{1," $FILE; then
            echo "❌ user_name regex must allow letters"
            exit 1
          fi

      - name: Success message
        run: echo "Schema passed all convention checks"
